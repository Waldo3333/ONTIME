<div class="flight-show-title">
    <h1>Mon vol vers <br> <%= @flight.destination.capitalize %></h1>
</div>

<div class="flight-show-task-container">
    <div class="flight-show-task-title">
      <p>Mes tâches</p>
    </div>
    <div class="flight-show-task-link">
      <div class="flight-show-task-link-items">
        <%= link_to "Administratif", flight_tasks_path %>
        <span></span>
      </div>
      <div class="flight-show-task-link-items">
        <%= link_to "Ma valise", flight_tasks_path %>
        <span></span>
      </div>
      <div class="flight-show-task-link-items">
        <%= link_to "Avant de partie", flight_tasks_path %>
        <span></span>
      </div>
    </div>
</div>

<div class="flight-show-alert-container"  data-controller="display-alert-form">
    <div class="flight-show-alert-title">
      <p>Alertes</p>
    </div>

    <div class="flight-show-alert-card-container">
  <% @alerts.each do |alert| %>
    <%= turbo_frame_tag dom_id(alert) do%>
      <div class="flight-show-alert-wrapper" data-alert-id="<%= alert.id %>">
        <div class="flight-show-alert-card" data-action="click->display-alert-form#switchVote">
          <i class="fa-solid fa-triangle-exclamation"></i>
          <%= render 'alerts/alert', alert: alert %>
        </div>

        <% unless alert.user == current_user %>
          <div class="flight-show-alert-card-vote show-form-hidden">
              <%= button_to upvote_alert_path(alert), disabled: alert.is_voted_by_user?(current_user), method: :patch do  %>
                <i class="fa-solid fa-thumbs-up "></i>
              <% end %>
              <%= button_to downvote_alert_path(alert), disabled: alert.is_voted_by_user?(current_user) , method: :patch, turbo: false do  %>
                <i class="fa-solid fa-thumbs-down"></i>
              <% end %>
          </div>
      <% end %>
       </div>
    <% end %>
  <% end %>
  </div>

    <div class="flight-show-alert-form-display">
         <div class="flight-show-alert-form show-form-hidden" data-display-alert-form-target="togglableElement">
          <%= render "alerts/form" %>
        </div>
        <button data-action="click->display-alert-form#switch">
          <p class="" data-display-alert-form-target="togglableElementPlus"> + </p>
          <p class="show-form-hidden" data-display-alert-form-target="togglableElementMoins"> - </p>
        </button>

    </div>
</div>

<div class="flight-show-main-card-container">
    <div class="flight-show-main-card-info">
      <div class="flight-show-main-card">
        <h2>Départ </h2>
        <p>(au plus tard)</p>
        <h3><%= @final_timing %></h3>
      </div>
      <div class="flight-show-main-card">
        <h2>Décollage</h2>
        <p>(au plus tard)</p>
        <h3><%= @flight.takeoff_time.strftime("%H:%M")%></h3>
      </div>
    </div>

    <% nav_links = google_maps_navigation_link(@flight.user_departure_address, "aeroport #{@flight.airport}", @flight.mobility_choice) %>

    <div class="flight-show-main-card-link">
      <a id="maps-nav-link" href="<%= nav_links[:web] %>" target="_blank">Lancer la navigation</a>
    </div>


    <div class="flight-show-map_container" >

    <%= render "gps" %>
    </div>
</div>

<div class="flight-show-detail-main-container" data-controller="toggle-information">
    <div class="flight-show-detail-container "
      data-action="click->toggle-information#disable">
      <h3>Information sur votre vol</h3>
      <div class="flight-show-detail-info flight-show-detail-toggle"
      data-toggle-information-target="details">


          <div class="departure-child">
            <p class="departure-title">Départ:</p>
            <p><%= @flight.takeoff_time.strftime("%d/%m/%Y") %>  <%= @flight.takeoff_time.strftime("%H:%M") %></p>

          </div>
          <div class="departure-child">
            <p class="departure-title">Arrivée:</p>
            <p><%= @flight.landing_time.strftime("%d/%m/%Y") %> <%= @flight.landing_time.strftime("%H:%M") %></p>
          </div>

          <div class="departure-child">
              <p class="departure-title">Aéroport <br> de départ: </p>
              <p><%= @flight.airport  %></p>
          </div>

          <div class="departure-child">
            <p class="departure-title">Terminal: </p>
            <p><%= @flight.terminal  %></p>
          </div>

          <div class="departure-child">
            <p class="departure-title">Porte:</p>
            <p> <%= @flight.gate  %></p>
          </div>


          <div class="departure-child">
              <p class="departure-title">Aéroport <br> d'arrivée: </p>
              <p><%= @flight.destination  %></p>
          </div>

          <div class="departure-child">
              <p class="departure-title">N° vol: </p>
              <p><%= @flight.flight_number   %></p>
          </div>

          <div class="departure-child">
              <p class="departure-title">Vol prévu sur terminal: </p>
              <p> <%= @flight.estimated_wait %> </p>
          </div>


        <%  if @flight.international  %>
        <p>C'est un vol vers l'internationnal</p>
        <% end %>
      </div>


    </div>

    <div class="flight-show-detail-container "
      data-action="click->toggle-information#disablePersonal">
      <h3>Vos préferences</h3>
      <div class="flight-show-detail-info flight-show-detail-toggle"
        data-toggle-information-target="personal">
        <% if @flight.duration_second.present? %>

        <div class="departure-child">
              <p class="departure-title">Départ de: </p>
              <p><%= @flight.user_departure_address %></p>
        </div>

        <div class="departure-child">
              <p class="departure-title">Temps de trajet: </p>
              <p><%= "#{@hours } h #{@minutes.to_s.rjust(2, '0')}"%></p>
        </div>

          <% else %>
          <div class="departure-child">
            <p class="departure-title">Durée du trajet non disponible.</p>
          </div>
          <% end %>
        <% if @flight.valise  %>
          <div class="departure-child">
            <p class="departure-title">Vous devez enregistrer une valise</p>
          </div>
        <% end %>
        <div class="departure-child">
            <p class="departure-title">Moyen de deplacement: </p>
            <p> <%= @flight.mobility_choice_label %></p>
        </div>
        <div class="departure-child">
            <p class="departure-title">Temps d'avance souhaité: </p>
            <p><%= @flight.arrival_time_wanted %> min</p>
        </div>
      </div>
    </div>
</div>

<div class="flight-show-button">
    <%= link_to "Voir autres vols", flights_path(@flights)%>
    <%= link_to "Supprimer", flight_path(@flight),
                              data: { turbo_method: :delete, turbo_confirm: "Supprimer cette réservation ?" } %>
</div>


<%# <script>window.open("https://google.com", "_blank")</script> %>
<script>
      document.addEventListener("DOMContentLoaded", function() {
        var userAgent = navigator.userAgent || navigator.vendor || window.opera;
        var link = document.getElementById("maps-nav-link");

        var destination = encodeURIComponent("aeroport <%= @flight.airport %>");
        var origin = encodeURIComponent("<%= @flight.user_departure_address %>");
        var travelmode = "<%= @flight.mobility_choice %>";

        var dirflg = "d";

        if (travelmode === "walking") {
          dirflg = "w";
        } else if (travelmode === "bicycling") {
          dirflg = "b";
        } else if (travelmode === "transit") {
          dirflg = "r";
        } else {
          dirflg = "d";
        }

        if (/android/i.test(userAgent)) {
          link.href = "intent://maps.google.com/maps?daddr=" + destination + "&dirflg=" + dirflg + "#Intent;scheme=https;package=com.google.android.apps.maps;end;";
        } else if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
          link.href = "comgooglemaps://?saddr=" + origin + "&daddr=" + destination + "&directionsmode=" + travelmode + "&navigate=yes";
        } else {
          link.href = "https://www.google.com/maps/dir/?api=1&origin=" + origin + "&destination=" + destination + "&travelmode=" + travelmode;
        }
      });
    </script>
